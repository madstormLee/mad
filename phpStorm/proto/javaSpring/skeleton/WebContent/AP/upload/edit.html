<html>
<head>
<title>InnoAP</title>
<script language="JavaScript" src="InnoAP.js"></script>
<script language="JavaScript">
<!--
function OnInnoAPLoad()
{
	SetInnoAPInit();
}

// g_ExistFiles
// 임시 파일들의 삭제 플래그를 세팅하기 위한
// 전역 변수
// AddTempFile의 세번째 인자로 지정되는 아이디를
// 키로 갖는다.
var g_ExistFiles = new Array();
function SetInnoAPInit()
{
	// 초기화 시에 삭제 플래그를 false로 세팅한다.
	document.InnoAP.RemoveAllFiles();
	document.InnoAP.AddTempFile("a.zip", 33333, "a.zip");
	g_ExistFiles['a.zip'] = false;

	document.InnoAP.AddTempFile("b.txt", 22222, "b.txt");
	g_ExistFiles['b.txt'] = false;

	document.InnoAP.AddTempFile("c.doc", 44444, "c.doc");
	g_ExistFiles['c.doc'] = false;
}

function StartUpload(obj)
{
	for (var i = 0; i < document.InnoAP.GetCount; i++)
	{
		// 사용자가 제거하지 않은 임시 파일의 경우
		// g_ExistFiles 배열에서 해당 아이디값을 키로 갖는
		// 변수의 플래그를 true 로 설정 한다.
		if (document.InnoAP.IsTempFile(i))
		{
			g_ExistFiles[document.InnoAP.GetFileID(i)] = true;
		}
	}

	for (var key in g_ExistFiles)
	{
		// 임시파일의 id 를 각각
		// exist_file 과 deleted_file 변수에 배열형태로 담아 전송한다.
		if (g_ExistFiles[key] == true)
		{
			document.InnoAP.AppendPostData("exist_file", key);
		}
		else
		{
			document.InnoAP.AppendPostData("deleted_file", key);
		}
	}

	var ret = InnoAPSubmit(obj);

	// 리스트에 파일이 없어 form이 직접 전송 되는 경우
	if (ret == true)
	{
		var oForm = document.edit_form;
		for (var key in g_ExistFiles)
		{
			// form에 지워진 파일의 수 만큼 key를 추가한다.
			var oInput  = document.createElement('<input type="hidden" name="deleted_file" value="' + key + '">');
			oForm.insertAdjacentElement("afterBegin", oInput);
		}
	}

	return ret;
}
//-->
</script>
</head>

<body>

<form name="edit_form" action="edit_action.jsp" method="post"
	enctype="multipart/form-data"
	onSubmit="return StartUpload(this); return false;" style="margin: 0px;">
test1 : <input type="text" name="test1"><br>

<table border=0 cellspacing=0 cellpadding=0>
	<tr>
		<td style="border: 1px solid #C0C0C0;" colspan=2><script
			language="JavaScript">
<!--
var InputName = "demo";
var ActionFilePath = "edit_action.jsp";

var ListStyle = "Large Icon";
var ShowFullPath = "false";

InnoAPInit(10240, 5120, 10, 0, 450, 150);
//-->
    </script></td>
	</tr>
	<tr>
		<td><input type="button" value="파일찾기"
			onClick="document.InnoAP.OpenFile();"><br>
		<input type="submit" value="전송하기"></td>
		<td align=right><input type="button" value="첨부파일 초기화"
			onClick="SetInnoAPInit();"></td>
	</tr>
</table>

</form>

<script for="InnoAP" event="OnUploadComplete(ResponseData);">
<!--
// ResponseData 에는 업로드 완료 후
// 화면에 표시되는 html 코드가 담겨 있습니다.
// 이 변수를 사용하여 다음 작업을 진행 하실 수 있습니다.

//document.write(ResponseData);
//-->
</script>

</body>
</html>

